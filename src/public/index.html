<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Transfer</title>
        <style>
            
            #room {
                margin-bottom: 10px;
            }

            body {
                display: flex;
            }

            #form {
                margin:auto;
            }

            #text {
                margin-top: 20px;
            }

        </style>
       <script src="/socket.io/socket.io.js"></script>
       <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    </head>
    <body>
        <div id="form">
            <div>
                <p>Transfer</p>
                <input id="room"/>
                <button id="join-btn">Join</button>
            </div>
            <div style="display: flex;">
                <div>
                    <textarea id='contentInput'></textarea>
                    <button id="apply-btn">Apply</button>
                </div>
            </div>
            <div id="text"></div>
            <input type="file" name="image" id="image"/>
        </div>
        <script type="module">

            const text = document.getElementById('text');
            const roomInput = document.getElementById('room');
            const contentInput = document.getElementById('contentInput');
            const joinButton = document.getElementById("join-btn");
            joinButton.addEventListener("click", handleJoin, false);
            const applyButton = document.getElementById("apply-btn");

            applyButton.addEventListener("click", handleApply, false);
            
            const api = axios.create({
                baseURL:"http://localhost:3000"
            })

            const imageInput = document.getElementById("image");
            image.addEventListener("change", handleImageChange);

            function handleImageChange(event){
                const image = event.target.files[0];

                const data = new FormData();
                data.append("image", image);
                data.append("name", "Test");

                upload(data);
            }

            async function upload(data){
               const response = await api.post("/upload", data);

                console.log(response.data);
            }

            let myRoom;

            function handleJoin(event){
                event.preventDefault();
                socket.emit('join', roomInput.value);
                myRoom = roomInput.value;
            }

            function handleApply(event){
                event.preventDefault();

                if(!myRoom) return;

                const roomData = {
                    text: contentInput.value,
                    room: myRoom
                }

                socket.emit('transferData', roomData);
            }

            const socket = io();
            
            socket.on('message', (message)=>{
                text.innerText = message;
            })

        </script>
    </body>
</html>
